\usepackage{xeCJK}
\usepackage{calc}
\usepackage[heading=true]{ctex}
\usepackage{lipsum}
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{geometry}
\usepackage{fancybox}
\usepackage{filecontents}

\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{bbding}
\usepackage{pifont}
\usepackage{wasysym}
\usepackage{amssymb}

\usepackage[T1]{fontenc}

\geometry{paperwidth=210mm,paperheight=297mm,left=2.5cm,right=2.5cm,top=2.54cm,bottom=2.54cm}

\fancypage{%
  \setlength{\fboxsep}{\npusep}%
  \setlength{\shadowsize}{0pt}%
  \shadowbox}{}

\ifx\ctexset\undefined
  \CTEXsetup[format={\zihao{4}\bfseries}]{section}
  \CTEXsetup[format={\zihao{-4}\bfseries}]{subsection}
\else
  \ctexset{%
    section={%
      format={\zihao{4}\bfseries},
      beforeskip=5pt,
      afterskip=5pt,
      name={,、},
      aftername={\hspace{0pt}},
      number={\chinese{section}}
    }}
  \ctexset{%
    subsection={%
      format={\zihao{-4}\bfseries},
      beforeskip=5pt,
      afterskip=0pt
    }}
  \ctexset{%
    subsubsection={%
      format={\zihao{5}\bfseries},
      beforeskip=3pt,
      afterskip=0pt
    }}
\fi

\let\npusection\section
\def\npustarsection#1{\npusection{#1}}
\def\section{\secdef\npusection\npustarsection}
\def\cutrule{\noindent\hskip-\npusep\rule{\npuwidth}{0.4pt}}
\def\npubreak{\noindent\hskip-\npusep\rule{\npuwidth}{0.4pt}}

\newlength{\npusep}
\newlength{\npuwidth}
\newlength{\npucorrect}
\newlength{\npucorrecttop}
\setlength{\npusep}{10pt}
\setlength{\npuwidth}{\textwidth}
\addtolength{\npuwidth}{2\npusep}
\setlength{\npucorrect}{5pt}
\addtolength{\npucorrect}{-\npusep}
\setlength{\npucorrecttop}{-10pt}
\addtolength{\npucorrecttop}{-\npusep}
\newlength{\npucone}
\setlength{\npucone}{2cm}
\newlength{\npuctwo}
\setlength{\npuctwo}{\npuwidth}
\addtolength{\npuctwo}{-\npucone}
\newcommand\npuitem[2][3cm]{\parbox[c][#1][c]{\npucone}{\centering #2}}
\newcommand\npusig[2][2.5cm]{\parbox[c][#1][c]{\npuctwo}{%
  \vskip 0pt plus15fil \hskip2cm #2：
  \hskip 0pt plus15fil 201\quad 年\quad 月\quad 日}}

\newif\ifnpucheckbase\npucheckbasefalse
\newif\ifnpucheckapply\npucheckapplyfalse
\newif\ifnpucheckengine\npucheckenginefalse
\newif\ifnpucheckoverall\npucheckoverallfalse
\newif\ifnpucheckfirst\npucheckfirstfalse
\newif\ifnpuchecksecond\npuchecksecondfalse
\newif\ifnpucheckphd\npucheckphdfalse
\newif\ifnpucheckms\npucheckmsfalse

%设置中文字体
%\let\songti\relax
%\let\heiti\relax
%\let\fangsong\relax
%\let\kaishu\relax
%
%\newCJKfontfamily\sonti{方正书宋简体}[BoldFont=方正粗宋简体]
%\newCJKfontfamily\heiti{方正黑体简体}[BoldFont=方正正粗黑简体]
%\newCJKfontfamily\fangsong{方正仿宋简体}
%\newCJKfontfamily\kaishu{方正楷体简体}[BoldFont=方正粗楷简体]
%
%\setCJKmainfont{方正书宋简体}[BoldFont = 方正粗宋简体]
%\setCJKsansfont{方正黑体简体}[BoldFont = 方正正粗黑简体]
%\setCJKmonofont{方正仿宋简体}

\setCJKfamilyfont{kaishu}[AutoFakeBold = {2.17}]{KaiTi}
%\setCJKmainfont[AutoFakeBold,ItalicFont={楷体}]{楷体}
\renewcommand*{\kaishu}{\CJKfamily{kaishu}}


\def\npunew#1#2{%
  \expandafter\def\csname npuinner#1\endcsname{#2}
  \expandafter\def\csname npu#1\endcsname##1{%
    \expandafter\def\csname npuinner#1\endcsname{##1}}}
\npunew{title}{<开题报告题目>}
\npunew{number}{<学号>}
\npunew{school}{<学院>}
\npunew{major}{<专业>}
\npunew{name}{<姓名>}
\npunew{degree}{<学位>}
\npunew{supervisor}{<导师>}
\npunew{type}{<培养类别>}
\npunew{date}{<日期>}


\def\maketitlepage{
  \thisfancypage{}{}
  \begin{titlepage}
    \linespread{1.25}
    \begin{center}
      \newlength{\npunolenght}
      \newlength{\nputmplenght}
      
%      \newcommand\npucu[1]{\uline{\hfill ##1 \hfill}}
%      \newcommand\npucu[1]{\hfill ##1 \hfill}
      \newcommand\npucu[1]{\coverunderline[5.5cm]{\hfill ##1 \hfill}}
      
      
      \newcommand\npumb[2][\nputmplenght]{\makebox[##1][s]{##2}}
      \newcommand\npucoveritem[2]{\npumb[\nputmplenght]{##1}\npucu{##2}\newline}
      \zihao{-4}
      \settowidth{\npunolenght}{20002010000000}
      %\hfill 学号: \npumb[\npunolenght]{\npucu{\npuinnernumber}}
      \vskip 2cm
      {\kaishu\zihao{1}\noindent\textbf{\makebox[7cm][s]{西北工业大学}}}\par
      \vskip 1.5cm
      {\kaishu\zihao{1}\noindent \textbf{研究生学位论文选题报告表}}\par
      %\vskip 1.5cm
      \kaishu\zihao{4}
      \vskip 0pt plus 5fil
      {\kaishu\zihao{4}\noindent 攻读学位级别：\ifnpucheckphd $\surd$ \else $\Box$ \fi 博士 \ \ \ \ \ifnpucheckms $\surd$ \else $\Box$ \fi 硕士}\par
      \vskip 1cm
      \settowidth{\nputmplenght}{学科、专业}
      
      
      \begin{minipage}{8.5cm}\linespread{1.8}\selectfont
        \noindent
        \npucoveritem{学院}{\npuinnerschool}
        \npucoveritem{姓名}{\npuinnername}
        \npucoveritem{学号}{\npuinnernumber}
        \npucoveritem{学科、专业}{\npuinnermajor}
        %\npucoveritem{学位级别}{\npuinnerdegree}
        \npucoveritem{指导教师}{\npuinnersupervisor}
        %\npucoveritem{培养类别}{\npuinnertype}
        \npucoveritem{填表日期}{\npuinnerdate}
      \end{minipage}


      \vskip 0pt plus 5fil\zihao{3}
      \makebox[3.5cm][c]{西北工业大学研究生院}
    \end{center}
  \end{titlepage}
  \clearpage}

\def\makeinnerpage{
  \thisfancypage{}{}
  \begin{center}
    {\kaishu \zihao{-2} \textbf{研究生学位论文开题报告的要求 }}
  \end{center}\vskip1cm
  \newcounter{npulc}{%
  \zihao{-4}
  \begin{list}{\chinese{npulc}、}{\settowidth\labelwidth{一、}\usecounter{npulc}}
  	
  \item \kaishu 硕士生的选题报告内容应包括文献综述、选题意义、研究内容、研究方案，论文
        工作量的估计、工作条件，预期达到的水平，存在的问题及拟采取的解决措施。
  \item 博士生的选题报告内容应包括文献综述、选题背景及其意义、研究内容、研究特
        色、工作难点、预期成果及其可能的创新点。
  \item 正式开题之前，研究生应在广泛阅读中、外文资料的基础上，深入了解拟选课题
        的国内外研究动态，把握所选课题的目的、意义和预期结果，明确课题工作的设
        想、方法和研究路径。
  \item 博士生在规定的时间内，写出开题报告初稿，经指导教师审阅同意后，进行开题
        报告的送审。开题报告评审未通过者，修后重新送审，若第二次送审仍通不过者，
        则按有关规定终止学籍。
  \item 不能按期申请开题评议者，应及时向学院提出延期申请。
  \item 本表若不够填写时，可另加附页。
  \end{list}}
  \clearpage}


\def\makehead{
  \newgeometry{paperwidth=210mm,paperheight=297mm,%
  left=2cm,right=2.5cm,top=2.54cm,bottom=2.54cm}
  \newlength{\tabline}
  \setlength{\tabline}{172.1mm}
  \setlength{\npuwidth}{\tabline}
  \hrule height0pt\vskip\npucorrecttop{%
  \renewcommand{\arraystretch}{1.5}
  \newcolumntype{C}{>{\hfil}X<{\hfil}}
  \noindent\hskip-\npusep
  \begin{tabularx}{\npuwidth}{>{\centering}X|C|C|C|C}
    \bfseries{论文题目} & \multicolumn{4}{c}{\npuinnertitle} \\ \hline
    \bfseries{开题次数} & \multicolumn{2}{r}{\ifnpucheckfirst $\CheckedBox$ \else $\Box$ \fi 第一次$\,\,\,\,\,\,\,\,$} & \multicolumn{2}{l}{$\,\,\,\,\,\,$ \ifnpuchecksecond $\CheckedBox$ \else $\Box$ \fi 第二次} \\ \hline
    \multirow{2}*{\parbox{0.18\npuwidth}{%
        \centering \bfseries{论文类型\\(请在有关项目下作$\surd$记号)}}} %
    & 基础研究 & 应用研究 & 工程技术 & 跨学科研究 \\ \cline{2-5}
    & \ifnpucheckbase $\surd$ \fi   & \ifnpucheckapply $\surd$ \fi  
    & \ifnpucheckengine $\surd$ \fi & \ifnpucheckoverall $\surd$\fi \\\hline
  \end{tabularx}}
  %\vskip
  %\npusep
  %\noindent{\kaishu
  %  研究生在进行选题报告、听取意见后，整理成文（不少于3500字）。}
  \par}


\def\maketail{
  \filbreak
  \hrule height0pt \vfill
  {\noindent\hskip-\npusep\tabcolsep=0pt%
  \renewcommand{\arraystretch}{1.5}\zihao{-4}%
  \begin{tabularx}{\npuwidth}{c|X}\hline
  %\npuitem[4.5cm]{指导教师\\意\qquad 见} & \npusig[4.5cm]{指导教师（签名）}  \\\hline
  %\npuitem[3.5cm]{院\quad 系\\意\quad 见}& \npusig[3.5cm]{院系负责人（签名）}\\\hline
  %\npuitem[]{研究生院\\复核时间}       & \npusig{复核人签名（签章）}\\\hline
  \npuitem[2.0cm]{备注}                  &  \\
  \end{tabularx}}
  \vskip\npucorrect}


\AtBeginDocument{\maketitlepage}
\AtBeginDocument{\makeinnerpage}
\AtBeginDocument{\makehead}

\AtEndDocument{\maketail}
\renewcommand{\normalsize}{\zihao{5}}
\pagestyle{plain}

\newtheorem{theorem}{定理}
\newtheorem{lemma}[theorem]{引理}
\newtheorem{corollary}[theorem]{推论}
\newtheorem{proposition}[theorem]{命题}
% \theoremstyle{definition}
\newtheorem{definition}[theorem]{定义}

% \linespread{1.5}
